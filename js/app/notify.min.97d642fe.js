define(function(e,t,i){t.init=function(){e(["visibility","pace","store2","moment","cache"],function(e,t,i,n,o){e=window.Visibility;var c={url:"/check",check:function(){1!=c.checking&&(c.checking=!0,t.ignore(function(){return $.getJSON(c.url,function(e){1==e.success&&(void 0!==c.user_id?e.user_id==c.user_id?(c.token=e.token,$.ajaxSetup({headers:{"X-CSRF-TOKEN":e.csrf}})):location.reload(!0):(c.user_id=e.user_id,c.token=e.token,c.username=e.username),void 0!==e.cache_timestamp&&c.cache(e.cache_timestamp),void 0!==e.notification&&c.notify(e.notification))}).fail(function(){return c.show()})}),c.checking=!1)},cache:function(e){var t=i.get("cache_timestamp");null==t?i.set("cache_timestamp",e):(n(t.traders).isSame(e.traders)||i.remove("licensee"),n(t.products).isSame(e.products)||(i.remove("products"),o("products","/filter/products")),n(t.ports).isSame(e.ports)||(i.remove("ports"),o("ports","/filter/ports")),i.set("cache_timestamp",e))},notify:function(e){void 0!==e.mailbox&&c.mailbox(e.mailbox),void 0!==e.user&&c.registration(e.user)},mailbox:function(e){return $(".main-menu-button[name=mailbox] > a i").attr("up-keep","").attr("data-notify",e||null)},registration:function(e){$(".main-menu-button[name=home] > label i").attr("up-keep","").attr("data-notify",e||null),$(".main-menu-button .link-list > li[name=accounts-management]").attr("up-keep","").attr("data-notify",e||null)},show:function(){1==confirm("Session Expired. Press Ok to Login")?$.getJSON(c.url,function(e){e.user_id==c.user_id?(c.token=e.token,$.ajaxSetup({headers:{"X-CSRF-TOKEN":e.csrf}})):location.reload(!0)}).fail(function(){return location.reload(!0)}):location.reload(!0)},checking:!1};setTimeout(function(){0==c.checking&&(e.hidden()||e.onVisible(function(){c.check()}),e.change(function(e,t){"visible"==t&&c.check()}),e.every(3e5,function(){c.check()}))},1e4)})}});

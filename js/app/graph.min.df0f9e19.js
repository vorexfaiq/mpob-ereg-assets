define(function(t,e,n){e.init=function(e){t(["chart","mustache","store2","tooltipster"],function(t,n,a,o){var i=a.namespace("contracts-tooltip");i.clearAll(),chartEl=$("#chart-outliers-price-trend");var r=e.data("label"),l=e.data("price"),s={labels:r,datasets:[{label:"outliers"==e.data("type")?"Contract":"Price",fill:!1,showLine:!1,pointBorderColor:"rgba(224,22,20,1)",pointBackgroundColor:"rgba(224,22,20,0.7)",borderColor:"rgba(224,22,20,1)",backgroundColor:"rgba(224,22,20,0.7)",data:l}]},c=new t(e[0].getContext("2d"),{type:"line",data:s,options:{legend:{display:!0,labels:{boxWidth:5,usePointStyle:!0},position:"bottom"},layout:{padding:{right:10}},scales:{yAxes:[{ticks:{beginAtZero:!1,scaleOverride:!0,min:parseInt($("input[name=min_price]").val()),max:parseInt($("input[name=max_price]").val())},scaleLabel:{display:!0,labelString:"Price"}}],xAxes:[{display:!0,ticks:{beginAtZero:!0,autoSkip:!0,padding:10,stepSize:1,callback:function(t,n,a){return"outliers"==e.data("type")?n+1:t},min:0},scaleLabel:{display:!0,labelString:"outliers"==e.data("type")?"Contract":"Date"},offset:!1}]},hover:{onHover:function(t){this.getElementAtEvent(t).length?$(t.currentTarget).css("cursor","pointer"):$(t.currentTarget).css("cursor","default")}},tooltips:{enabled:!1,custom:function(t){var a,o=t.title;if(o&&"outliers"==chartEl.data("type")){var l=r[o];$("div[name="+l+"]").length>0?a=$("div[name="+l+"]"):(a=$("<div />",{class:"tooltip-point",css:{left:t.caretX,top:t.caretY},name:l}).insertAfter(chartEl)).tooltipster({animation:null,updateAnimation:null,theme:"tooltipster-noir",content:"Loading...",contentAsHTML:!0,selfDestruction:!1,trigger:"custom",delay:0,functionBefore:function(){$.each($.tooltipster.instances(),function(t,e){e.close()})}}),i.has(l)?(a.tooltipster("content")!=i.get(l)&&a.tooltipster("content",i.get(l)),a.tooltipster("open")):a.tooltipster("open",function(t,e){$.getJSON("/contract-management/contracts/"+l+"?type=tooltip",function(e){i.set(o,n.render($("#chartjs-tooltip-template-outliers").html(),e)),t.content(n.render($("#chartjs-tooltip-template-outliers").html(),e))})})}else if(o&&"trends"==chartEl.data("type")){var s=e.data("total"),c=e.data("weightage");l=r[o];$("div[name="+l+"]").length>0?a=$("div[name="+l+"]"):(a=$("<div />",{class:"tooltip-point",css:{left:t.caretX,top:t.caretY},name:l}).insertAfter(chartEl)).tooltipster({animation:null,updateAnimation:null,theme:"tooltipster-noir",content:"Loading...",contentAsHTML:!0,selfDestruction:!1,trigger:"custom",delay:0,functionBefore:function(){$.each($.tooltipster.instances(),function(t,e){e.close()})}}),a.tooltipster("open",function(t,e){t.content(n.render($("#chartjs-tooltip-template-trends").html(),{total:s[o],weightage:c[o]}))})}else{var p=$.tooltipster.instances();$.each(p,function(t,e){e.close()})}}}}});e[0].onclick=function(t){if(chartEl=$("#chart-outliers-price-trend"),"outliers"==chartEl.data("type")){var e=c.getElementsAtEvent(t)[0];if(void 0!==e){var n=c.data.datasets[e._datasetIndex],a=c.data.labels[e._index];n.data[e._index];window.open("/contract-management/contracts/"+a,"_blank")}}}})}});

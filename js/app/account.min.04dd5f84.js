define(function(e,n,t){n.init=function(n){var t,a={},o={},c=[];e(["account.module.datatables","account.module.datatables.query","account.module.datatables.download","account.module.datatables.action","sweetalert2"],function(e,i,r,u,l){$(".filter-form").find("select,:input:not(button):not([type=radio]):not([type=checkbox]),input[type=radio]:checked,input[type=checkbox]:checked").each(function(e,n){a[$(n).attr("name")]=$(n).val()}),t=e.datatables(n,a,o),query=i.query(t,a,o),download=r.download(t,a,o),add=u.add(t),t.on("click",'a[target="_blank"]',function(e){e.preventDefault();var n=Math.random(),t=window.open($(e.currentTarget).attr("href"),"_blank");return t.window.name=n,c.push({id:n,win:t}),!1}),window.closeMe=function(e){$.map(c,function(n){return n.id==e?n.win:null})[0].close(),window.focus(),t.ajax.reload(null,!1)},$(".btn-bar").on("click",".btn-license_no",function(e){l.fire({title:"Changing License Number",text:"This will change your license number and cannot be reverted. Please ensure you insert correct license number. Your username will be updated and you need to re-login using new username.",icon:"warning",input:"text",width:800,animation:!1,showCancelButton:!0,confirmButtonText:'<i class="fa fa-check"></i> Proceed',showLoaderOnConfirm:!0,cancelButtonText:'<i class="fa fa-times"></i> Cancel',reverseButtons:!0,allowOutsideClick:function(){return!l.isLoading()},preConfirm:function(e){if(""!=e)return new Promise(function(n){$.ajax({url:"/accounts/license-no",type:"POST",data:{license_no:e},success:function(n){l.fire({title:e,text:"Success. Please login using your new username.",icon:"info"}).then(function(e){e.value&&window.location.reload()})},error:function(e){var t=JSON.parse(e.responseText);l.showValidationMessage(t.errors.license_no),n()}})});l.showValidationMessage("License Number must not be empty")}})})})}}),define("account.module.datatables.columnDefs",function(){return function(e){return[{targets:0,className:"nowrap"}]}}),define("account.module.datatables.columns",["mustache"],function(e){return function(e,n){return $.map(e,function(e){return $(e).data("checkbox")?{data:"id",render:function(e,t,a){return'<div class="checkbox check-info"><input type="checkbox" id="check-'+e+'" class="select-checklist" value="'+e+'" '+(e in n?'checked="checked"':"")+'><label for="check-'+e+'"></label></div>'},className:"small-cell"}:{data:$(e).data("column"),defaultContent:""}})}}),define("account.module.datatables.query",function(){return{query:function(e,n,t){$(".btn.btn-query").on("click",function(t){t.preventDefault(),$(".filter-form").find("select,:input:not(button):not([type=radio]):not([type=checkbox]),input[type=radio]:checked,input[type=checkbox]:checked").each(function(e,t){n[$(t).attr("name")]=$(t).val()}),e.draw()})}}}),define("account.module.datatables",["datatables","account.module.datatables.columns","account.module.datatables.columnDefs"],function(){return{datatables:function(e,n,t){var a=e.find("thead tr th");return e.DataTable({pageLength:25,processing:!0,serverSide:!0,ordering:!1,dom:'rt<"bottom row blur"<"col-md-2 al"l><"col-md-4"i><"col-md-6"p>><"clear">',columns:require("account.module.datatables.columns")(a,t),columnDefs:require("account.module.datatables.columnDefs")(a),language:{sLengthMenu:"Show _MENU_",processing:'<div class="dot-falling"></div>'},ajax:{url:location.href,data:function(e){return $.extend(e,n)},error:function(e,n,t){401==e.status&&window.location.reload()}}})}}}),define("account.module.datatables.download",function(){return{download:function(e,n,t){$(".btn.btn-download-account").on("click",function(e){e.preventDefault(),window.location="/accounts/user-export?"+$.param(n)})}}}),define("account.module.datatables.action",function(){return{add:function(e){$(".btn.btn-add").on("click",function(n){n.preventDefault(),require(["sweetalert2","mustache","select2"],function(t,a,o){var c=$(n.target).find("script").html();t.fire({title:$(n.target).data("title")?$(n.target).data("title"):"Add New",html:a.render(c),confirmButtonText:"Register",showCancelButton:!0,focusConfirm:!1,allowOutsideClick:function(){return!t.isLoading()},preConfirm:function(){var a=$(t.getContent()),o=$(n.target).data("input").split(","),c={};return $.each(o,function(e,n){if(a.find("[name="+n+"]").prop("required")&&""==a.find("[name="+n+"]").val()){var o=a.find("[name="+n+"]").siblings("label").clone().children().remove().end().text();return t.showValidationMessage(o+" is required")}inputform=a.find("[name="+n+"]"),inputform.is(":radio")||inputform.is(":checkbox")?c[n]=a.find("[name="+n+"]:checked").val():c[n]=a.find("[name="+n+"]").val()}),t.showLoading(),$.post(window.location.href,c).then(function(n){if(1==n.success)return console.log(n),e.ajax.reload(null,!1),n}).catch(function(e){var n=e.responseJSON.errors;void 0!==n[Object.keys(n)[0]][0]?t.showValidationMessage(n[Object.keys(n)[0]][0]):t.showValidationMessage("Error: Unable to add.")})},onOpen:function(e){$(e).find("input.datepicker").daterangepicker({singleDatePicker:!0,showDropdowns:!0,minYear:1990,locale:{format:"DD/MM/YYYY"}})}}).then(function(e){e.value&&t.fire({title:"Success",html:void 0!==e.value.message?e.value.message:"Data has been added",icon:"success",position:"top-end",showConfirmButton:!1,timer:3e3})})})})}}});
